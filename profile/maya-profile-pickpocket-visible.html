
<!-- Maya Blogger Profile with Slots, Buyback, and Pickpocket -->

<div style="max-width:400px;margin:20px auto;background:#111;padding:20px;border-radius:12px;font-family:sans-serif;color:#fff;">
  <h2 style="text-align:center;color:#fff;font-size:24px;">Maya</h2>
  <p><strong>Role:</strong> Courier</p>
  <p><strong>Mood:</strong> <span id="moodText">Balanced</span></p>
  <p><strong>On Drug:</strong> <span id="drugEffect">None</span></p>
  <div id="loyaltyStatus">Loyalty: Neutral</div>

  <h3>Slots</h3>
  <div id="slotGrid" style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:15px;"></div>

  <h3>Give Drug</h3>
  <select id="giveSelect" style="width:100%;padding:6px;margin-bottom:10px;"></select>
  <button style="padding:10px;border:none;border-radius:6px;font-weight:bold;cursor:pointer;padding:10px;border:none;border-radius:6px;background:#2ecc71;color:#fff;font-weight:bold;cursor:pointer;" onclick="giveDrug()" style="width:100%;">Give to Maya</button>

  <h3>Buy Back</h3>
  <div id="buyBackSlot" style="margin-bottom:10px;"></div>

  <h3>Pickpocket</h3>
  <button style="padding:10px;border:none;border-radius:6px;font-weight:bold;cursor:pointer;padding:10px;border:none;border-radius:6px;background:#2ecc71;color:#fff;font-weight:bold;cursor:pointer;" onclick="tryPickpocket()" style="width:100%;background:#c0392b;color:#fff;border:none;padding:10px;border-radius:6px;">Pickpocket Slot</button>
  <p id="pickResult" style="margin-top:8px;color:#f39c12;"></p>
</div>

<b:if cond='true'>
<script>
const npcId = "maya";
function getStats() {
  return JSON.parse(localStorage.getItem("stats")) || { xp: 0, rep: 0, cash: 0, heat: 0, level: 1 };
}
function saveStats(stats) {
  localStorage.setItem("stats", JSON.stringify(stats));
  localStorage.setItem("statsUpdated", Date.now());
}
function getLoyalty() {
  return parseInt(localStorage.getItem(npcId + "_loyalty") || "0");
}
function getStorage() {
  return JSON.parse(localStorage.getItem(npcId + "_storage") || "[]");
}
function saveStorage(data) {
  localStorage.setItem(npcId + "_storage", JSON.stringify(data));
}
function getInventory() {
  return JSON.parse(localStorage.getItem("inventory") || "[]");
}
function saveInventory(inv) {
  localStorage.setItem("inventory", JSON.stringify(inv));
}
function renderGiveOptions() {
  const sel = document.getElementById("giveSelect");
  sel.innerHTML = "";
  getInventory().forEach(item => {
    sel.innerHTML += `<option value="${item.name}|${item.icon}">${item.icon} ${item.name}</option>`;
  });
}
function giveDrug() {
  const val = document.getElementById("giveSelect").value;
  if (!val) return;
  const [name, icon] = val.split("|");
  let inv = getInventory();
  let store = getStorage();
  if (store.length >= 5) return alert("All slots are full.");
  const idx = inv.findIndex(i => i.name === name);
  if (idx === -1) return;
  inv.splice(idx, 1);
  store.push({ name, icon, locked: false, used: false });
  saveInventory(inv);
  saveStorage(store);
  render();
}
function tryPickpocket() {
  const stats = getStats();
  const loyalty = getLoyalty();
  const storage = getStorage();
  const unlocked = storage.filter(s => !s.locked && !s.used);
  const result = document.getElementById("pickResult");

  if (unlocked.length === 0) {
    result.textContent = "No open slots to steal from.";
    return;
  }

  const chance = Math.min(0.6, 0.2 + loyalty / 100 + stats.rep / 100);
  const roll = Math.random();
  if (roll < chance) {
    const stolen = unlocked[Math.floor(Math.random() * unlocked.length)];
    let inv = getInventory();
    inv.push({ name: stolen.name, icon: stolen.icon, desc: "Stolen from Maya" });
    saveInventory(inv);
    result.textContent = `Success! You stole ${stolen.icon} ${stolen.name}`;
    const idx = storage.findIndex(s => s.name === stolen.name && !s.locked && !s.used);
    if (idx > -1) storage.splice(idx, 1);
    saveStorage(storage);
  } else {
    stats.heat += 5;
    saveStats(stats);
    result.textContent = "Caught! Heat increased.";
  }
  render();
}
function render() {
  const stats = getStats();
  const loyalty = getLoyalty();
  const store = getStorage();

  document.getElementById("loyaltyStatus").textContent = "Loyalty: " + loyalty;
  const grid = document.getElementById("slotGrid");
  grid.innerHTML = "";
  store.forEach((item, i) => {
    grid.innerHTML += `<div style="background:#222;padding:10px;border-radius:8px;">
      ${item.icon} ${item.name}<br><small>${item.locked ? "Locked" : "Unlocked"}</small>
    </div>`;
  });
  while (store.length < 5) {
    grid.innerHTML += `<div style="background:#333;padding:10px;border-radius:8px;color:#777;">[Empty]</div>`;
    store.push({ name: "", icon: "", locked: true, used: true });
  }

  // Buyback: Only first unused, unlocked item
  const bbSlot = store.find(i => !i.used && !i.locked && i.name);
  document.getElementById("buyBackSlot").innerHTML = bbSlot
    ? `<button style="padding:10px;border:none;border-radius:6px;font-weight:bold;cursor:pointer;padding:10px;border:none;border-radius:6px;background:#2ecc71;color:#fff;font-weight:bold;cursor:pointer;" onclick="buyBack('${bbSlot.name}', '${bbSlot.icon}')" style="width:100%">${bbSlot.icon} Buy Back ${bbSlot.name}</button>`
    : "<p style='color:#aaa;'>No available buy back item</p>";
}
function buyBack(name, icon) {
  let inv = getInventory();
  let store = getStorage();
  const idx = store.findIndex(i => i.name === name && i.icon === icon && !i.used);
  if (idx > -1) {
    store.splice(idx, 1);
    inv.push({ name, icon, desc: "Bought back from Maya" });
    saveInventory(inv);
    saveStorage(store);
    render();
  }
}
document.addEventListener("DOMContentLoaded", () => {
  renderGiveOptions();
  render();
});
</script>
</b:if>
