<!DOCTYPE html>
<html>
<head>
  <title>Maya - Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #101010; color: white; font-family: sans-serif; padding: 20px; margin: 0; }
    .container { max-width: 400px; margin: auto; }
    h2, h4 { text-align: center; }
    .slot-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
    .slot { background: #1a1a1a; padding: 10px; border-radius: 8px; text-align: center; min-height: 60px; }
    button { background: #333; color: white; border: none; padding: 6px 10px; margin-top: 5px; border-radius: 6px; cursor: pointer; }
    button:hover { background: #444; }
    select { background: #222; color: white; border-radius: 6px; padding: 6px; width: 100%; margin-top: 10px; }
    .buyback { margin-top: 20px; }
  </style>
  <script src="https://sggregory76.github.io/Hustletrap/global-logic-rp.js"></script>
</head>
<body>
<div class="container">
  <h2>Maya</h2>
  <h4>Role: Street Dealer</h4>

  <div>
    <strong>Mood:</strong> <span id="npcMood">Loading...</span><br>
    <strong>On Drug:</strong> <span id="npcDrug">Loading...</span>
  </div>

  <div class="slot-grid" id="npcSlots"></div>

  <h4>Give Maya an Item</h4>
  <select id="giveSelect"></select>
  <button onclick="giveToNPC()">Give</button>

  <div class="buyback">
    <h4>Buy Back from Maya</h4>
    <select id="buySelect"></select>
    <button onclick="buyBackFromNPC()">Buy Back</button>
  </div>

  <div id="resultMessage" style="margin-top:15px;text-align:center;color:yellow;"></div>
</div>

<script>
let npcInventory = JSON.parse(localStorage.getItem("mayaInventory")) || [
  { name: "Marijuana", icon: "üåø", type: "drug" }
];

let npcMood = "Chill";
let npcDrug = "Marijuana";

function updateNPCMood() {
  npcMood = ["Chill", "Irritated", "Happy", "Suspicious"][Math.floor(Math.random()*4)];
  npcDrug = ["Marijuana", "Xanax", "Adderall", "LSD"][Math.floor(Math.random()*4)];
  document.getElementById("npcMood").innerText = npcMood;
  document.getElementById("npcDrug").innerText = npcDrug;
}

function saveInventory() {
  localStorage.setItem("mayaInventory", JSON.stringify(npcInventory));
}

function renderInventory() {
  const slots = document.getElementById("npcSlots");
  slots.innerHTML = "";
  for (let i = 0; i < 5; i++) {
    let slot = npcInventory[i] ? npcInventory[i].icon + " " + npcInventory[i].name : "Empty Slot";
    slots.innerHTML += `<div class="slot">${slot}</div>`;
  }
}

function renderGiveSelect() {
  const inv = JSON.parse(localStorage.getItem("inventory")) || [];
  const give = document.getElementById("giveSelect");
  give.innerHTML = inv.map((item, idx) => `<option value="${idx}">${item.icon || "‚ùî"} ${item.name}</option>`).join("") || "<option disabled>No Items</option>";
}

function renderBuySelect() {
  const buy = document.getElementById("buySelect");
  buy.innerHTML = npcInventory.map((item, idx) => `<option value="${idx}">${item.icon || "‚ùî"} ${item.name}</option>`).join("") || "<option disabled>No Items</option>";
}

function giveToNPC() {
  const idx = document.getElementById("giveSelect").value;
  if (idx === "" || idx == null) return;
  let playerInv = JSON.parse(localStorage.getItem("inventory")) || [];
  const item = playerInv.splice(idx, 1)[0];
  if (!item) return;

  if (npcInventory.length < 5) {
    npcInventory.push({ name: item.name, icon: item.icon, type: "drug" });
    localStorage.setItem("inventory", JSON.stringify(playerInv));
    saveInventory();
    renderInventory();
    renderGiveSelect();
    renderBuySelect();
    logEntry(`Gave ${item.name} to Maya.`);
    document.getElementById("resultMessage").innerText = "Gave item successfully!";
  } else {
    document.getElementById("resultMessage").innerText = "No available slot!";
  }
}

function buyBackFromNPC() {
  const idx = document.getElementById("buySelect").value;
  if (idx === "" || idx == null) return;
  const item = npcInventory.splice(idx, 1)[0];
  if (!item) return;

  const playerInv = JSON.parse(localStorage.getItem("inventory")) || [];
  playerInv.push(item);
  localStorage.setItem("inventory", JSON.stringify(playerInv));
  saveInventory();
  renderInventory();
  renderGiveSelect();
  renderBuySelect();
  logEntry(`Bought back ${item.name} from Maya.`);
  document.getElementById("resultMessage").innerText = "Bought back item!";
}

function npcAutoSellOrUse() {
  if (npcInventory.length === 0) return;
  const idx = Math.floor(Math.random() * npcInventory.length);
  const item = npcInventory[idx];

  if (item.type === "drug") {
    if (Math.random() < 0.7) { 
      // 70% chance to sell
      npcInventory.splice(idx,1);
      logEntry(`Maya sold ${item.name} on the street.`);
      awardRPSale(item.name);
    } else {
      // 30% chance to use
      npcInventory.splice(idx,1);
      logEntry(`Maya used ${item.name}.`);
      awardRPUse(item.name);
    }
    saveInventory();
    renderInventory();
    renderBuySelect();
  }
}

function logEntry(message) {
  const logs = JSON.parse(localStorage.getItem("gameLog")) || [];
  logs.unshift({ time: new Date().toLocaleString(), message });
  localStorage.setItem("gameLog", JSON.stringify(logs));
}

document.addEventListener("DOMContentLoaded", () => {
  updateNPCMood();
  renderInventory();
  renderGiveSelect();
  renderBuySelect();
  setInterval(npcAutoSellOrUse, 15000); // Attempt auto sale/use every 15s
});
</script>
</body>
</html>
