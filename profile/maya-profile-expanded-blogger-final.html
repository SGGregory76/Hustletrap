
<!-- Blogger-Compatible Maya Profile with Loyalty, Auto-Use, Buyback -->

<div style="max-width:400px;margin:20px auto;background:#111;padding:20px;border-radius:12px;font-family:sans-serif;color:#fff;">
  <h2>Maya</h2>
  <p><strong>Role:</strong> Courier</p>
  <p><strong>Mood:</strong> <span id="moodText">Balanced</span></p>
  <p><strong>On Drug:</strong> <span id="drugEffect">None</span></p>
  <div style="margin:15px 0;" id="loyaltyStatus">Loyalty: ...</div>

  <h3>Storage</h3>
  <div id="storageSlots" style="margin-bottom:10px;"></div>

  <h3>Give Drug</h3>
  <select id="giveSelect" style="width:100%;padding:6px;"></select>
  <button class="buybackBtn" id="giveBtn" style="width:100%;margin-top:8px;">Give to Maya</button>

  <h3>Buy Back</h3>
  <div id="buyBackArea"></div>
</div>

<b:if cond='true'><script>
const npcId = "maya";
const drugData = {
  "Marijuana": { icon:"ðŸŒ¿", delay:30000, price:10, xp:1 },
  "Adderall": { icon:"ðŸ’Š", delay:45000, price:20, xp:2 },
  "Cocaine": { icon:"â„ï¸", delay:60000, price:30, xp:3 },
  "LSD": { icon:"ðŸ”®", delay:90000, price:40, xp:4 },
  "Oxytocin": { icon:"ðŸ’‰", delay:120000, price:50, xp:5 }
};

function getStats() {
  return JSON.parse(localStorage.getItem("stats")) || { xp:0, rep:0, cash:0, heat:0, level:1 };
}
function saveStats(stats) {
  localStorage.setItem("stats", JSON.stringify(stats));
  localStorage.setItem("statsUpdated", Date.now());
}
function getLoyalty() {
  return parseInt(localStorage.getItem(npcId + "_loyalty") || "0");
}
function getStorage() {
  return JSON.parse(localStorage.getItem(npcId + "_storage") || "[]");
}
function saveStorage(data) {
  localStorage.setItem(npcId + "_storage", JSON.stringify(data));
}
function getUnlockedSlots() {
  let s = getStats();
  return 3 + (s.rep >= 10 ? 1 : 0) + (s.level >= 3 ? 1 : 0);
}
function getInventory() {
  return JSON.parse(localStorage.getItem("inventory") || "[]");
}
function saveInventory(inv) {
  localStorage.setItem("inventory", JSON.stringify(inv));
}
function log(msg) {
  const logs = JSON.parse(localStorage.getItem("gameLog") || "[]");
  logs.unshift({ time: new Date().toLocaleTimeString(), message: msg });
  localStorage.setItem("gameLog", JSON.stringify(logs));
}

function giveDrug() {
  const val = document.getElementById("giveSelect").value;
  if (!val) return;
  const [name, icon] = val.split("|");
  let inv = getInventory();
  let store = getStorage();
  if (store.length >= getUnlockedSlots()) return alert("No available storage slots.");
  const idx = inv.findIndex(i => i.name === name);
  if (idx === -1) return;

  inv.splice(idx, 1);
  store.push({ name, icon, time: Date.now(), used: false });
  saveInventory(inv);
  saveStorage(store);
  renderUI();
}

function renderGiveOptions() {
  const sel = document.getElementById("giveSelect");
  sel.innerHTML = "";
  getInventory().forEach(i => {
    sel.innerHTML += `<option value="${i.name}|${i.icon}">${i.icon} ${i.name}</option>`;
  });
}

function getTier(loyalty) {
  if (loyalty >= 70) return { tier: "Trusted", payout: 1.3, useChance: 0.3 };
  if (loyalty >= 30) return { tier: "Neutral", payout: 1.0, useChance: 0.2 };
  return { tier: "Suspicious", payout: 0.8, useChance: 0.4 };
}

function renderUI() {
  const stats = getStats();
  const loyalty = getLoyalty();
  const tier = getTier(loyalty);
  const store = getStorage();

  document.getElementById("loyaltyStatus").innerHTML = `Loyalty: <strong>${tier.tier}</strong> (${loyalty})`;

  // Storage display
  const unlocked = getUnlockedSlots();
  let html = "", buyback = "";
  store.forEach((item, i) => {
    const d = drugData[item.name];
    const ready = Date.now() - item.time >= d.delay;
    const willUse = Math.random() < tier.useChance;
    if (ready && !item.used) {
      let payout = Math.floor(d.price * tier.payout);
      stats.cash += payout;
      stats.rep += 1;
      stats.xp += d.xp;
      if (willUse) {
        log(`Maya used ${item.icon} ${item.name}. Paid you $${payout}`);
      } else {
        log(`Maya sold ${item.icon} ${item.name}. Paid you $${payout}`);
      }
      item.used = true;
    }
    html += `<div style="margin:6px 0;padding:6px;background:#1d1d1d;border-radius:6px;">
      ${item.icon} ${item.name} ${item.used ? "- Done" : "- Processing..."}
    </div>`;

    if (!item.used) {
      buyback += `<button class="buybackBtn" data-index="${i})" style="margin-bottom:5px;width:100%">${item.icon} Buy Back ${item.name}</button>`;
    }
  });
  saveStorage(store);
  saveStats(stats);

  for (let i = store.length; i < 5; i++) {
    html += `<div style="margin:6px 0;padding:6px;border:1px dashed #444;border-radius:6px;">${i < unlocked ? "[ Empty ]" : "[ Locked ]"}</div>`;
  }

  document.getElementById("storageSlots").innerHTML = html;
  document.getElementById("buyBackArea").innerHTML = buyback;
}

function buyBack(index) {
  let store = getStorage();
  const item = store.splice(index, 1)[0];
  let inv = getInventory();
  inv.push({ name: item.name, icon: item.icon, desc: "Recovered from Maya" });
  saveInventory(inv);
  saveStorage(store);
  renderUI();
}


function attachEventHandlers() {
  const giveBtn = document.getElementById("giveBtn");
  if (giveBtn) giveBtn.addEventListener("click", giveDrug);

  const buyBtns = document.querySelectorAll(".buybackBtn");
  if (buyBtns.length) {
    buyBtns.forEach(btn => {
      btn.addEventListener("click", (e) => {
        const idx = e.target.getAttribute("data-index");
        if (idx !== null) buyBack(parseInt(idx));
      });
    });
  } else {
    setTimeout(attachEventHandlers, 500);
  }
}

document.addEventListener("DOMContentLoaded", () => {
  renderGiveOptions();
  renderUI();
  attachEventHandlers();
  setInterval(() => {
    renderUI();
    attachEventHandlers();
  }, 10000);
});

  renderGiveOptions();
  renderUI();
  setInterval(renderUI, 10000);
});
</script></b:if>
