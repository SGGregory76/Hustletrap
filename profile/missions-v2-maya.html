
<!DOCTYPE html>
<html>
<head>
  <title>Maya Mission Arc</title>
  <style>
    body { background: #101010; color: white; font-family: sans-serif; padding: 20px; }
    .mission { background: #1c1c1c; padding: 12px; border-radius: 8px; margin-bottom: 15px; }
    .mission button { margin-top: 8px; background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; }
    .mission em { color: #aaa; }
  </style>
</head>
<body>
  <h2 style="text-align:center;">Maya's Mission Arc</h2>
  <div id="missionList"></div>

  <script>
    const missions = [
      { id: "maya1", title: "Night Drop", desc: "Simple late-night courier run.", reward: "LSD", icon: "🔮", xp: 5, rep: 3, reqRep: 0 },
      { id: "maya2", title: "Extended Route", desc: "Long delivery across several blocks.", reward: "Adderall", icon: "💊", xp: 6, rep: 4, reqRep: 5 },
      { id: "maya3", title: "High-Risk Pickup", desc: "Cops are sniffing around. Do you bribe or run?", reward: "Oxytocin", icon: "💉", xp: 8, rep: 5, reqRep: 12, choice: true },
      { id: "maya4", title: "Undercover Deal", desc: "Trade with rival faction's buyer. Don't get caught.", reward: "Loyalty Flag", icon: "🕵️", xp: 10, rep: 6, reqRep: 14, needs: "maya3" },
      { id: "maya5", title: "Promotion or Parting", desc: "Decide Maya’s future: Crew or cut ties.", reward: "Perk Choice", icon: "⭐", xp: 12, rep: 8, reqRep: 16, needs: "maya4" }
    ];

    function getStats() {
      return JSON.parse(localStorage.getItem("stats") || "{}");
    }

    function getCompleted() {
      return JSON.parse(localStorage.getItem("completedMissions") || "[]");
    }

    function saveCompleted(list) {
      localStorage.setItem("completedMissions", JSON.stringify(list));
    }

    function addToInventory(name, icon) {
      const inv = JSON.parse(localStorage.getItem("inventory") || "[]");
      inv.push({ name: name, icon: icon, desc: "Mission reward" });
      localStorage.setItem("inventory", JSON.stringify(inv));
    }

    function logEntry(msg) {
      const log = JSON.parse(localStorage.getItem("gameLog") || "[]");
      log.unshift({ time: new Date().toLocaleString(), message: msg });
      localStorage.setItem("gameLog", JSON.stringify(log));
    }

    function completeMission(index, choice = null) {
      const m = missions[index];
      const stats = getStats();
      const completed = getCompleted();

      if (completed.includes(m.id)) return;

      stats.xp = stats.xp || 0;
      stats.rep = stats.rep || 0;
      stats.cash = stats.cash || 0;
      stats.heat = stats.heat || 0;

      stats.xp += m.xp;
      stats.rep += m.rep;

      if (m.id === "maya3" && choice === "bribe") {
        localStorage.setItem("perk_loyal_delivery", "true");
        stats.cash -= 25;
        logEntry("You bribed the cops. Unlocked Perk: Loyal Delivery.");
      } else if (m.id === "maya3" && choice === "run") {
        stats.heat += 2;
        logEntry("You ran from the cops. Heat +2.");
      } else if (m.id === "maya4") {
        localStorage.setItem("flag_undercover_complete", "true");
        logEntry("Undercover mission flagged.");
      } else if (m.id === "maya5") {
        if (choice === "crew") {
          localStorage.setItem("perk_maya_loyalist", "true");
          logEntry("Maya joined your crew! Perk Unlocked: Maya Loyalist.");
        } else if (choice === "cut") {
          logEntry("You and Maya parted ways.");
        }
      } else {
        addToInventory(m.reward, m.icon);
      }

      completed.push(m.id);
      saveCompleted(completed);
      localStorage.setItem("stats", JSON.stringify(stats));
      localStorage.setItem("statsUpdated", Date.now());
      renderMissions();
    }

    function renderMissions() {
      const stats = getStats();
      const completed = getCompleted();
      const div = document.getElementById("missionList");

      div.innerHTML = missions.map((m, i) => {
        const isUnlocked = (stats.rep || 0) >= m.reqRep;
        const done = completed.includes(m.id);
        const requires = m.needs && !completed.includes(m.needs);
        if (requires) return "";

        let btn = "";
        if (!isUnlocked) {
          btn = `<em>Requires REP ${m.reqRep}</em>`;
        } else if (done) {
          btn = `<span style='color:#888;'>Completed</span>`;
        } else if (m.choice && m.id === "maya3") {
          btn = `
            <button onclick="completeMission(${i}, 'bribe')">Bribe ($25)</button>
            <button onclick="completeMission(${i}, 'run')">Run</button>`;
        } else if (m.id === "maya5") {
          btn = `
            <button onclick="completeMission(${i}, 'crew')">Keep Maya (Crew)</button>
            <button onclick="completeMission(${i}, 'cut')">Cut Ties</button>`;
        } else {
          btn = `<button onclick="completeMission(${i})">Complete</button>`;
        }

        return `<div class="mission">
          <strong>${m.title}</strong><br>
          ${m.desc}<br>
          <small>XP: ${m.xp}, REP: ${m.rep}</small><br>
          ${btn}
        </div>`;
      }).join("");
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (!localStorage.getItem("completedMissions")) {
        localStorage.setItem("completedMissions", "[]");
      }
      renderMissions();
    });
  </script>
</body>
</html>
