
<!DOCTYPE html>
<html>
<head>
  <title>Maya - Profile (Clean)</title>
  <style>
    body { background: #101010; color: white; font-family: sans-serif; padding: 20px; }
    .inventory-slot {
      background: #1a1a1a; padding: 10px; margin-bottom: 8px;
      border-radius: 8px; display: flex; justify-content: space-between;
    }
    button {
      background: #66f; color: white; border: none;
      padding: 4px 10px; border-radius: 5px; cursor: pointer;
    }
    .used { color: #ffcc00; font-style: italic; }
  </style>
</head>
<body>
  <h2>Maya</h2>
  <p><strong>Role:</strong> Street Dealer</p>
  <p><strong>Current Mood:</strong> <span id="moodText">Neutral</span></p>
  <p><strong>Currently on Drug:</strong> <span id="drugEffect">None</span></p>

  <h3>Inventory</h3>
  <div id="npcInventory"></div>

  <h4>Give Drug to Maya</h4>
  <select id="giveSelect" style="width:100%;margin-bottom:10px;"></select>
  <button onclick="giveDrug()">Give</button>

  <p id="logMsg" style="margin-top:10px;color:#ffe600;"></p>

  <script>
    const npcId = "maya";

    const defaultInventory = [
      { name: "Adderall", icon: "ðŸ’Š", qty: 1, price: 50 },
      null, null, null, null
    ];

    if (!localStorage.getItem(npcId + "_inventory")) {
      localStorage.setItem(npcId + "_inventory", JSON.stringify(defaultInventory));
    }

    let npcInventory = JSON.parse(localStorage.getItem(npcId + "_inventory"));
    let npcMood = localStorage.getItem(npcId + "_mood") || "Neutral";
    let npcOnDrug = localStorage.getItem(npcId + "_onDrug") || "None";

    function getPlayerInventory() {
      return JSON.parse(localStorage.getItem("inventory") || "[]");
    }

    function removeFromPlayerInventory(name) {
      let inv = getPlayerInventory();
      const index = inv.findIndex(item => item.name === name);
      if (index !== -1) inv.splice(index, 1);
      localStorage.setItem("inventory", JSON.stringify(inv));
    }

    function giveDrug() {
      const selected = document.getElementById("giveSelect").value;
      if (!selected) return;

      for (let i = 0; i < npcInventory.length; i++) {
        if (!npcInventory[i]) {
          const parts = selected.split("|");
          npcInventory[i] = { name: parts[0], icon: parts[1], qty: 1, price: 40 };
          removeFromPlayerInventory(parts[0]);
          localStorage.setItem(npcId + "_inventory", JSON.stringify(npcInventory));
          document.getElementById("logMsg").textContent = `Gave ${parts[1]} ${parts[0]} to Maya.`;
          renderInventory();
          renderGiveSelect();
          maybeUseDrug(i);
          return;
        }
      }

      document.getElementById("logMsg").textContent = "Maya's inventory is full.";
    }

    function maybeUseDrug(index) {
      const item = npcInventory[index];
      const useChance = Math.random();
      if (useChance > 0.6) {
        npcOnDrug = item.name;
        npcMood = {
          "Adderall": "Hyperactive",
          "LSD": "Unpredictable",
          "Marijuana": "Chill",
          "Oxytocin": "Affectionate",
          "Unknown Compound": "Unstable"
        }[item.name] || "Affected";

        npcInventory[index] = null;
        localStorage.setItem(npcId + "_onDrug", npcOnDrug);
        localStorage.setItem(npcId + "_mood", npcMood);
        localStorage.setItem(npcId + "_inventory", JSON.stringify(npcInventory));
        renderInventory();
        renderMood();
      }
    }

    function renderMood() {
      document.getElementById("moodText").textContent = npcMood;
      document.getElementById("drugEffect").textContent = npcOnDrug;
    }

    function renderInventory() {
      npcInventory = JSON.parse(localStorage.getItem(npcId + "_inventory")) || [];
      const container = document.getElementById("npcInventory");
      container.innerHTML = "";
      npcInventory.forEach(item => {
        if (item) {
          container.innerHTML += `
            <div class="inventory-slot">
              <span>${item.icon} <strong>${item.name}</strong> x${item.qty} - $${item.price}</span>
            </div>
          `;
        } else {
          container.innerHTML += `<div class="inventory-slot"><span class='used'>Empty Slot</span></div>`;
        }
      });
    }

    function renderGiveSelect() {
      const sel = document.getElementById("giveSelect");
      const inv = getPlayerInventory().filter(i => i.name && i.icon);
      if (inv.length === 0) {
        sel.innerHTML = "<option disabled>No items to give</option>";
        return;
      }
      sel.innerHTML = inv.map(i => `<option value="${i.name}|${i.icon}">${i.icon} ${i.name}</option>`).join("");
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderInventory();
      renderMood();
      renderGiveSelect();
      setInterval(renderGiveSelect, 15000);
    });
  </script>
</body>
</html>
