
<!DOCTYPE html>
<html>
<head>
  <title>Missions</title>
  <style>
    body { background: #101010; color: white; font-family: sans-serif; padding: 20px; }
    select, button {
      background: #222;
      color: white;
      padding: 6px;
      border-radius: 6px;
      border: none;
      margin-bottom: 12px;
      width: 100%;
    }
    .mission {
      background: #1c1c1c;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 12px;
    }
    .mission em { color: #aaa; }
  </style>
</head>
<body>
  <h2 style="text-align:center;">Mission Selector</h2>
  <select id="npcSelect" onchange="renderNPC(this.value)">
    <option value="maya">Maya</option>
    <option value="rico">Rico</option>
    <option value="blaze">Blaze</option>
    <option value="skye">Skye</option>
  </select>
  <div id="missionBox"></div>

  <script>
    const npcMissions = {
      maya: [
        { id: "maya1", title: "Night Drop", icon: "🔮", reward: "LSD", xp: 5, rep: 3, cash: 25, heat: 1, unlock: 0 },
        { id: "maya2", title: "Extended Route", icon: "💊", reward: "Adderall", xp: 6, rep: 4, cash: 40, heat: 2, unlock: 10 }
      ],
      rico: [
        { id: "rico1", title: "Protect Turf", icon: "🌿", reward: "Marijuana", xp: 4, rep: 3, cash: 20, heat: 1, unlock: 0 },
        { id: "rico2", title: "Intercept Deal", icon: "❄️", reward: "Cocaine", xp: 7, rep: 5, cash: 60, heat: 3, unlock: 8 }
      ],
      blaze: [
        { id: "blaze1", title: "Soil Mix Test", icon: "⚗️", reward: "Plant Base", xp: 3, rep: 2, cash: 15, heat: 0, unlock: 0 },
        { id: "blaze2", title: "Strain Sample Delivery", icon: "🌿", reward: "Mutant Weed", xp: 6, rep: 4, cash: 45, heat: 2, unlock: 12 }
      ],
      skye: [
        { id: "skye1", title: "Supplier Meeting", icon: "🛒", reward: "Glass Flask", xp: 4, rep: 3, cash: 30, heat: 1, unlock: 0 },
        { id: "skye2", title: "Party Supply Run", icon: "🌈", reward: "LSD", xp: 7, rep: 5, cash: 50, heat: 2, unlock: 10 }
      ]
    };

    function getStats() {
      return JSON.parse(localStorage.getItem("stats") || "{}");
    }

    function getCompleted() {
      return JSON.parse(localStorage.getItem("completedMissions") || "[]");
    }

    function setStats(stats) {
      localStorage.setItem("stats", JSON.stringify(stats));
      localStorage.setItem("statsUpdated", Date.now());
    }

    function saveCompleted(list) {
      localStorage.setItem("completedMissions", JSON.stringify(list));
    }

    function addToInventory(name, icon) {
      const inv = JSON.parse(localStorage.getItem("inventory") || "[]");
      inv.push({ name: name, icon: icon, desc: "Mission reward" });
      localStorage.setItem("inventory", JSON.stringify(inv));
    }

    function logEntry(message) {
      const logs = JSON.parse(localStorage.getItem("gameLog") || "[]");
      logs.unshift({ time: new Date().toLocaleString(), message });
      localStorage.setItem("gameLog", JSON.stringify(logs));
    }

    function completeMission(npcKey, i) {
      const mission = npcMissions[npcKey][i];
      const stats = getStats();
      const completed = getCompleted();

      if (completed.includes(mission.id)) return;

      stats.xp = stats.xp || 0;
      stats.rep = stats.rep || 0;
      stats.cash = stats.cash || 0;
      stats.heat = stats.heat || 0;

      stats.xp += mission.xp;
      stats.rep += mission.rep;
      stats.cash += mission.cash;
      stats.heat += mission.heat;

      addToInventory(mission.reward, mission.icon);
      completed.push(mission.id);
      setStats(stats);
      saveCompleted(completed);
      logEntry(`${npcKey.toUpperCase()} mission '${mission.title}' completed. Gained ${mission.icon} ${mission.reward}, XP +${mission.xp}, REP +${mission.rep}, CASH +$${mission.cash}, HEAT +${mission.heat}`);
      renderNPC(npcKey);
    }

    function renderNPC(npcKey) {
      const missions = npcMissions[npcKey];
      const stats = getStats();
      const completed = getCompleted();
      let html = "";

      missions.forEach((m, i) => {
        const unlocked = (stats.rep || 0) >= m.unlock;
        const done = completed.includes(m.id);
        html += `<div class="mission">
          <strong>${m.title}</strong><br>
          Reward: ${m.icon} ${m.reward}<br>
          XP: ${m.xp}, REP: ${m.rep}, Cash: $${m.cash}, Heat: ${m.heat}<br>
          ${!unlocked ? `<em>Requires REP ${m.unlock}</em>` :
            done ? `<span style='color:#888;'>Completed</span>` :
            `<button onclick="completeMission('${npcKey}', ${i})">Complete</button>`}
        </div>`;
      });

      document.getElementById("missionBox").innerHTML = html;
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (!localStorage.getItem("completedMissions")) {
        localStorage.setItem("completedMissions", "[]");
      }
      renderNPC("maya");
    });
  </script>
</body>
</html>
