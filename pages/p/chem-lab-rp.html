
<!DOCTYPE html>
<html>
<head>
  <title>Chem Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #0c0c0c; color: white; font-family: 'Segoe UI', sans-serif; padding: 20px; }
    .chem-lab-wrapper { max-width: 360px; margin: auto; background: #1a1a1a; padding: 15px; border-radius: 12px; }
    .chem-lab-wrapper button {
      margin-top: 5px; background-color: #333; color: white;
      border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer;
    }
    .chem-lab-wrapper button:hover { background-color: #444; }
    .inventory-icon {
      width: 60px; height: 60px; display: flex;
      align-items: center; justify-content: center;
      font-size: 24px; background: #1d1d1d;
      border-radius: 8px; cursor: pointer;
    }
  </style>
</head>
<body>
<div class="chem-lab-wrapper">
  <h3 style="text-align:center;">Chem Lab</h3>
  <p style="text-align:center;">Select two ingredients from inventory</p>
  <div id="labIcons" style="display:flex;flex-wrap:wrap;gap:10px;justify-content:center;"></div>
  <div style="text-align:center;margin-top:10px;">
    <p><strong>Selected:</strong> <span id="selectedItems">None</span></p>
    <button onclick="mixIngredients()">Mix</button>
    <p id="resultBox" style="margin-top:10px;"></p>
  </div>
</div>
<script>
function getStats() {
  const s = JSON.parse(localStorage.getItem("stats") || "{}");
  return { xp: s.xp || 0, rep: s.rep || 0, cash: s.cash || 0, heat: s.heat || 0, rp: s.rp || 0 };
}
function setStats(s) {
  localStorage.setItem("stats", JSON.stringify(s));
  localStorage.setItem("statsUpdated", Date.now());
}
function awardCraftRP(resultName) {
  const stats = getStats();
  let rpGain = 0;
  if (["Speedball", "Trip Serum", "Nerve Blend"].includes(resultName)) rpGain = 2;
  else if (["Mutant Plant", "Custom Weed Strain"].includes(resultName)) rpGain = 1;
  if (rpGain > 0) {
    stats.rp += rpGain;
    setStats(stats);
    const logs = JSON.parse(localStorage.getItem("gameLog") || "[]");
    logs.unshift({ time: new Date().toLocaleString(), message: `Earned RP +${rpGain} from crafting ${resultName}.` });
    localStorage.setItem("gameLog", JSON.stringify(logs));
  }
}
function getInventory() {
  return JSON.parse(localStorage.getItem("inventory")) || [];
}
function getCraftHistory() {
  const data = JSON.parse(localStorage.getItem("craftHistory")) || {};
  const today = new Date().toDateString();
  if (data.date !== today) {
    data.records = {}; data.date = today;
    localStorage.setItem("craftHistory", JSON.stringify(data));
  }
  return data.records || {};
}
function updateCraftHistory(resultName) {
  const data = JSON.parse(localStorage.getItem("craftHistory")) || { date: new Date().toDateString(), records: {} };
  data.records[resultName] = (data.records[resultName] || 0) + 1;
  localStorage.setItem("craftHistory", JSON.stringify(data));
}
function addToInventory(name) {
  const inv = getInventory();
  inv.push({ name, desc: "Crafted in Chem Lab" });
  localStorage.setItem("inventory", JSON.stringify(inv));
}
function logEntry(message) {
  const logs = JSON.parse(localStorage.getItem("gameLog") || "[]");
  logs.unshift({ time: new Date().toLocaleString(), message });
  localStorage.setItem("gameLog", JSON.stringify(logs));
}
let ingredients = [];
function selectIngredient(icon) {
  if (ingredients.length < 2) {
    ingredients.push(icon);
    document.getElementById("selectedItems").textContent = ingredients.join(" + ");
  }
}
function mixIngredients() {
  const stats = getStats();
  const combo = ingredients.join("");
  const history = getCraftHistory();
  let result = "Unknown Result", requiredXP = 0, dailyLimit = 1;
  if (combo === "üåøüåø") { result = "Custom Weed Strain"; requiredXP = 0; dailyLimit = 2; }
  else if (combo === "üíä‚ùÑÔ∏è") { result = "Speedball"; requiredXP = 10; dailyLimit = 1; }
  else if (combo === "üíâüîÆ") { result = "Trip Serum"; requiredXP = 20; dailyLimit = 1; }
  else if (combo === "üß™üåø") { result = "Mutant Plant"; requiredXP = 15; dailyLimit = 1; }
  else if (combo === "üíäüíâ") { result = "Nerve Blend"; requiredXP = 25; dailyLimit = 1; }
  if (stats.xp < requiredXP) {
    document.getElementById("resultBox").innerHTML = `<span style='color:#f55;'>Need XP ${requiredXP} to craft ${result}.</span>`;
    return;
  }
  if ((history[result] || 0) >= dailyLimit) {
    document.getElementById("resultBox").innerHTML = `<span style='color:#f55;'>Daily limit reached for ${result}. Try again tomorrow.</span>`;
    return;
  }
  addToInventory(result);
  logEntry(`Crafted ${result} in the Chem Lab.`);
  updateCraftHistory(result);
  awardCraftRP(result);
  document.getElementById("resultBox").innerHTML = `<strong>Result:</strong> ${result}`;
  ingredients = [];
  document.getElementById("selectedItems").textContent = "";
  renderInventoryIcons();
}
function renderInventoryIcons() {
  const inventory = getInventory();
  const grid = document.getElementById("labIcons");
  const unique = [...new Set(inventory.map(i => i.name))];
  const iconMap = {
    "Marijuana": "üåø", "Adderall": "üíä", "Cocaine": "‚ùÑÔ∏è", "Oxytocin": "üíâ",
    "LSD": "üîÆ", "Unknown Compound": "üß™"
  };
  grid.innerHTML = unique.map(name => {
    const icon = iconMap[name] || "‚ùî";
    return `<div class="inventory-icon" onclick="selectIngredient('${icon}')">${icon}</div>`;
  }).join("");
}
document.addEventListener("DOMContentLoaded", renderInventoryIcons);
</script>
</body>
</html>
